<!--

In order successfuly to use the sshexec/scp tasks you have to download from 
http://www.jcraft.com/jsch/index.html jsch-0.x.xx.jar and put it in 
%ANT_HOME%/lib folder as jsse.jar

Note for Eclipse User: When using ant from eclipse you can get jsse.jar by using 
	  "get.antscplib" additionally go to Windows>Preferences>Ant>Runtime>Classpath
	  and add the lib to the runtime classpath
-->
<project name="WSML 2 Reasoner Framework" basedir="." default="create_jar">
	<!-- set global properties for this build -->
	<tstamp />
	<!-- avoids pop ups if you create this file and set ssh.password and ssh.user
       on server also enables to reset src dir etc.-->
	<property file="pwd" />
	<property name="cvs.user" value="graham"/>
	<property name="cvs.path"
            value=":ext:${cvs.user}@cvs.deri.at:/usr/local/cvsroot" />
	<property name="dir.javadoc" location="${basedir}/javadoc" />
	<property name="dir.jUnit" location="${basedir}/jUnitReport" />
	<property name="dir.lib" location="${basedir}/lib" />
	<property name="dir.src" location="${basedir}/src" />
	<property name="dir.build" location="${basedir}/build" />
	<property name="dir.distribution" location="${basedir}/dist" />
	<property name="shell.host" value="tools.deri.org" />
	<property name="snapshot.path" value="/var/www/html/tools_deri_org/wsml/wsml2reasoner/snapshot/" />
	<property name="lib.wrapper"
            location="${dir.distribution}/wsml2reasoner-${DSTAMP}.jar" />
	<property name="lib.wrapper-wsmo"
	        location="${dir.distribution}/wsml2reasoner-wsmo-${DSTAMP}.jar" />
	<property name="lib.wrapper-src"
            location="${dir.distribution}/wsml2reasoner-src-${DSTAMP}.zip" />
	<property name="lib.wrapper-datalog"
	        location="${dir.distribution}/wsml2reasoner-datalog-${DSTAMP}.jar" />
	<property name="lib.wrapper-datalog-src"
            location="${dir.distribution}/wsml2reasoner-datalog-src-${DSTAMP}.zip" />
	<property name="lib.wrapper-dl"
	        location="${dir.distribution}/wsml2reasoner-dl-${DSTAMP}.jar" />
	<property name="lib.wrapper-dl-src"
            location="${dir.distribution}/wsml2reasoner-dl-src-${DSTAMP}.zip" />

	<path id="classpath">
		<fileset dir="${dir.lib}" includes="**/*.jar"/>
	</path>

	<target name="get.antscplib"
          description="Download necessary libary directly to ant lib">
		<get dest="${ant.library.dir}/jsse.jar"
         src="http://mesh.dl.sourceforge.net/sourceforge/jsch/jsch-0.1.18.jar" />
	</target>
	<!--
	<target name="compile-api">
		<mkdir dir="${dir.build}/api" />
		<javac debug="yes"
           srcdir="${basedir}/api/src"
           classpathref="classpath"
           destdir="${dir.build}/api"
           source="1.5"
           target="1.5" />
		<jar jarfile="${dir.lib}/wsml2reasoner-api.jar" 
			basedir="${dir.build}/api" 
			index="true" />
	</target>
	-->
	
	<target name="compile">
		<mkdir dir="${dir.build}" />
		<javac debug="yes"
           srcdir="${dir.src}:${basedir}/api/src"
           excludes="**/test/**/*.java"
           classpathref="classpath"
           destdir="${dir.build}"
           source="1.5"
           target="1.5" />
	</target>

	<target name="create_jar_local" depends="compile">
		<jar jarfile="wsml2reasoner.jar" 
			basedir="${dir.build}" 
			index="true" />
	</target>

	<target name="test.junit"
          description="Executes the unit test with files available in lib directory">

		<delete dir="${dir.build}" />
		<mkdir dir="${dir.build}" />
		<javac debug="yes"
           srcdir="${dir.src}/test"
           classpathref="classpath"
           destdir="${dir.build}"
           source="1.5"
           target="1.5"
           classpath="${lib.wrapper}" />

		<copy todir="${dir.build}">
			<fileset dir="${dir.src}" includes="examples/**/*.wsml">
			</fileset>
		</copy>

		<junit printsummary="yes">
			<classpath refid="classpath" />
			<classpath location="${lib.wrapper}" />
			<classpath path="${dir.build}" />
			<classpath path="./" />
			<formatter type="xml" />
			<batchtest todir="${dir.build}">
				<fileset dir="${dir.build}">
					<include name="**/*.class" />
					<exclude name="**/WSMLNormalizationTest.*"/>
					<exclude name="**/BaseTest.*"/>
					<exclude name="**/BaseReasonerTest.*"/>
				</fileset>
			</batchtest>
		</junit>

		<delete dir="${dir.jUnit}" />
		<mkdir dir="${dir.jUnit}" />
		<junitreport todir="${dir.build}">
			<fileset dir="${dir.build}">
				<include name="TEST-*.xml" />
			</fileset>
			<report format="frames" todir="${dir.jUnit}" />
		</junitreport>
		<delete dir="${dir.build}" />
	</target>

	<target name="cvs_checkout" description="checkout ext sources">
		<delete dir="${dir.src}"/>
		<mkdir dir="${dir.src}"/>
		<cvs compression="true"
        cvsroot="${cvs.path}"
        package="ext"
        dest="./"
        failonerror="true"/>
	</target>

	<target name="CleanCheckout+Reports" depends="cvs_checkout,create_jar,test.junit,javadoc">
	</target>

	<target name="create_jar"
          depends="compile"
          description="Creates a new version of the snapshot">
		<delete dir="${dir.distribution}" />
		<mkdir dir="${dir.distribution}" />
		<jar jarfile="${lib.wrapper}"
         basedir="${dir.build}"
         index="true" />
		<zip destfile="${lib.wrapper-src}"
         basedir="${basedir}"
         includes="api/**, src/**,examples/**,test/**" />
		<!--    <delete dir="${dir.build}" />-->
	</target>
	
	<target name="create_jar_dl"
          depends="compile"
          description="Creates a new version of the dl snapshot">
		<delete dir="${dir.distribution}" />
		<mkdir dir="${dir.distribution}" />
		<jar jarfile="${lib.wrapper-dl}"
         basedir="${dir.build}"
		 excludes="api/src/org/wsml/reasoner/api/WSMLCoreReasoner.class,
			api/src/org/wsml/reasoner/api/WSMLFlightReasoner.class,
			src/org/wsml/reasoner/builtin/kaon2/**,
			src/org/wsml/reasoner/builtin/mins/**,
			src/org/wsml/reasoner/impl/DatalogBasedWSMLReasoner.class,
			src/org/wsml/reasoner/DatalogReasonerFacade.class,
			src/org/wsml/reasoner/WSML2DatalogTransformer.class"
         index="true" />
		<zip destfile="${lib.wrapper-dl-src}"
         basedir="${basedir}"
         includes="api/**, src/**,examples/**,test/**" 
		 excludes="api/src/org/wsml/reasoner/api/WSMLCoreReasoner.java,
			api/src/org/wsml/reasoner/api/WSMLFlightReasoner.java,
			src/org/wsml/reasoner/builtin/kaon2/**,
			src/org/wsml/reasoner/builtin/mins/**,
			src/org/wsml/reasoner/impl/DatalogBasedWSMLReasoner.java,
			src/org/wsml/reasoner/DatalogReasonerFacade.java,
			src/org/wsml/reasoner/WSML2DatalogTransformer.java"/>
		<!--    <delete dir="${dir.build}" />-->
	</target>
	
	<target name="create_jar_datalog"
          depends="compile"
          description="Creates a new version of the datalog snapshot (w/MINS)">
		<delete dir="${dir.distribution}" />
		<mkdir dir="${dir.distribution}" />
		<jar jarfile="${lib.wrapper-datalog}"
         basedir="${dir.build}"
		 excludes="api/src/org/wsml/reasoner/api/WSMLDLReasoner.class,
			api/src/org/wsml/reasoner/api/serializer/owl/**,
			src/org/wsml/reasoner/builtin/pellet/**,,
			src/org/wsml/reasoner/impl/DLBasedWSMLReasoner.class,
			src/org/wsml/reasoner/transformation/dl/**,
			src/org/wsml/reasoner/DLReasonerFacade.class,
			src/org/wsml/reasoner/WSMLDL2OWLTransformer.class"
         index="true" />
		<zip destfile="${lib.wrapper-datalog-src}"
         basedir="${basedir}"
         includes="api/**, src/**,examples/**,test/**" 
		 excludes="api/src/org/wsml/reasoner/api/WSMLDLReasoner.java,
			api/src/org/wsml/reasoner/api/serializer/owl/**,
			src/org/wsml/reasoner/builtin/pellet/**,,
			src/org/wsml/reasoner/impl/DLBasedWSMLReasoner.java,
			src/org/wsml/reasoner/transformation/dl/**,
			src/org/wsml/reasoner/DLReasonerFacade.java,
			src/org/wsml/reasoner/WSMLDL2OWLTransformer.java"/>
		<!--    <delete dir="${dir.build}" />-->
	</target>
	
	<target name="create_libs_wsmo"
	          description="Selects required libs for wsml2reasoner-dl">
			<delete dir="${dir.distribution}/lib" />
			<mkdir dir="${dir.distribution}/lib" />
			<copy todir="${dir.distribution}/lib">
				<fileset dir="${dir.lib}/ext"
				includes="wsmo4j/**"/>
			</copy>
	</target>

	<target name="create_libs_dl"
          description="Selects required libs for wsml2reasoner-dl">
		<delete dir="${dir.distribution}/lib" />
		<mkdir dir="${dir.distribution}/lib" />
		<copy todir="${dir.distribution}/lib">
			<fileset dir="${dir.lib}/ext"
			excludes="axis/**, dlv/**, flora2/**, kaon2/**, 
				mandrax/**, mins/**, servlet/**, interprolog.jar"/>
		</copy>
	</target>
	
	<target name="create_libs_datalog"
          description="Selects required libs for wsml2reasoner-datalog">
		<delete dir="${dir.distribution}/lib" />
		<mkdir dir="${dir.distribution}/lib" />
		<copy todir="${dir.distribution}/lib">
			<fileset dir="${dir.lib}/ext"
			excludes="aterm/**, axis/**, commons-logging/**,
				dlv/**, flora2/**, kaon/**, kaon2/**, log4j/**,
				mandrax/**, owl-api/**, pellet/**, relaxng/**,
				servlet/**, xsdlib/**, interprolog.jar"/>
		</copy>
	</target>

	<target name="update_remote_snapshot"
          depends="choose_user_password"
          description="Updates wsml2reasoner snapshot on tools.deri.org">

		<!--delete old snapshot-->
		<sshexec host="${shell.host}"
             username="${ssh.user}"
             password="${ssh.password}"
             trust="yes"
             command="rm -f ${snapshot.path}/wsml2reasoner*" />

		<!--upload snapshot -->
		<scp file="${lib.wrapper}"
         trust="yes"
         todir="${ssh.user}:${ssh.password}@${shell.host}:${snapshot.path}" />

		<scp file="${lib.wrapper-src}"
         trust="yes"
         todir="${ssh.user}:${ssh.password}@${shell.host}:${snapshot.path}" />
	</target>

	<target name="choose_user_password">
		<input message="Username for ${shell.host}:" addproperty="ssh.user" />
		<input message="Password for ${shell.host}:" addproperty="ssh.password" />
	</target>

	<target name="javadoc" description="produces javadoc">
		<delete dir="${dir.javadoc}" />
		<mkdir dir="${dir.javadoc}" />
		<javadoc destdir="${dir.javadoc}"
             classpathref="classpath"
             author="true"
             version="true"
             use="true"
             windowtitle="WSML 2 Reasoner Framework">
			<fileset dir="${dir.src}">
				<include name="**/*.java" />
			</fileset>
			<fileset dir="${basedir}/api/src">
				<include name="**/*.java" />
			</fileset>
			<link href="http://wsmo4j.sourceforge.net/multiproject/wsmo-api/apidocs/"
            packagelistloc="http://wsmo4j.sourceforge.net/multiproject/wsmo-api/apidocs/package-list" />
			<link href="http://wsmo4j.sourceforge.net/multiproject/logexp-api/apidocs/"
            packagelistloc="http://wsmo4j.sourceforge.net/multiproject/logexp-api/apidocs/package-list" />
			<link href="http://java.sun.com/j2se/1.5.0/docs/api/"
            packagelistloc="http://java.sun.com/j2se/1.5.0/docs/api/package-list" />
			<doctitle><![CDATA[<h1>WSML 2 Reasoner Framework</h1>]]></doctitle>
		<bottom>
			<![CDATA[<i>Copyright &#169; 2005 University of Innsbruck, Austria; FZI, Germany. All Rights Reserved.</i>]]></bottom>
			<tag name="TODO" scope="all" description="To do:" />
		</javadoc>
	</target>
	
	<target name="nightly_build"
		depends="cvs_checkout, create_jar, javadoc, update_remote_snapshot"
		description="Generates nightly build">
	</target>

</project>

